@model AllCourseStudentsVM
@{
	Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Students - Instructor Dashboard</title>

    <style>
        /* Modal Container */
        .modern-light-modal {
            background: #ffffffcc;
            backdrop-filter: blur(12px);
            border-radius: 24px;
            border: 1px solid rgba(0,0,0,0.07);
            box-shadow: 0px 12px 35px rgba(0,0,0,0.12);
            padding-bottom: 10px;
            position: relative;
        }

        /* Close Button */
        .custom-close {
            position: absolute;
            right: 16px;
            top: 16px;
        }

        /* Avatar */
        .student-avatar-light {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #ffffff;
            box-shadow: 0 3px 12px rgba(0,0,0,0.15);
        }

        /* Message box */
        .message-box-light {
            min-height: 130px;
            border-radius: 16px;
            border: 1px solid rgba(0,0,0,0.1);
            background: #fafafa;
            font-size: 15px;
            padding: 14px;
            transition: 0.25s;
            resize: none;
        }

            .message-box-light:focus {
                border-color: #4f7cff;
                background: #fff;
                box-shadow: 0 0 0 4px rgba(80, 124, 255, 0.2);
            }

        /* Cancel button */
        .cancel-btn-light {
            background: #f1f1f1;
            border-radius: 12px;
            padding: 8px 20px;
            transition: 0.2s;
            font-weight: 500;
        }

            .cancel-btn-light:hover {
                background: #e5e5e5;
            }

        /* Send button */
        .send-btn-light {
            background: #4f7cff;
            color: #fff;
            border-radius: 12px;
            padding: 8px 20px;
            box-shadow: 0 5px 15px rgba(79, 124, 255, 0.3);
            transition: 0.25s;
            font-weight: 500;
        }

            .send-btn-light:hover {
                background: #3e6dfc;
                box-shadow: 0 8px 20px rgba(79, 124, 255, 0.4);
            }


       
    </style>



    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>


    <!-- Main Content -->
    <div class="col-lg-10 col-md-9 p-4" style="width: 100%;">
        <!-- Back to My Courses Button -->
        <a href="/Instructor/Course/Index"
           class="btn btn-light shadow-sm position-absolute top-0 end-0 m-4 px-4 py-2 rounded-pill fw-semibold"
           style="backdrop-filter: blur(6px); background: rgba(225,255,255,0.85);">
            ← Back to My Courses
        </a>
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold mb-2">My Students</h2>
                <p class="text-muted">Manage and track your students' progress</p>
            </div>

        </div>

        <!-- Toast Notification -->
        <div class="position-fixed top-0 end-0 p-3" style="z-index: 1050;">
            @if (TempData["SuccessMessage"] != null)
            {
                <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            @TempData["SuccessMessage"]
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            }
        </div>


        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var toastEl = document.getElementById('successToast');
                if (toastEl) {
                    var toast = new bootstrap.Toast(toastEl, { delay: 3000 }); // 3 seconds
                    toast.show();
                }
            });
        </script>

        <!-- Students List -->
        <div class="dashboard-card" style="margin-top: 44px;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold mb-0">Students List</h5>
                <div class="d-flex">
                    @* <div class="input-group me-2" style="width: 250px;">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control" placeholder="Search students...">
                    </div> *@


                    <form asp-action="DisplayCourseStudents"  method="get" class="d-flex mb-3">
                        <input type="hidden" name="id" value="@Model.CourseID" />
                        <input type="text" name="search" value="@Model.SearchTerm" class="form-control me-2" placeholder="Search by name or email">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </form>

                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Course</th>
                            <th>Progress</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>

                        @if (Model.AllCourseStudents.Count == 0)
                        {
                            <tr>
                                <td>
                                    <div class="alert alert-warning text-center mt-4" style="width:227%">
                                        No students found.
                                    </div>
                                </td>
                            </tr>
                            
                        }
                        else
                        {
                            @foreach (var std in Model.AllCourseStudents)
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img src=@(std.StudentImageUrl == null ? "/Images/Default_User_Image.jpg" : "/" + std.StudentImageUrl)
                                                 alt="Student" class="rounded-circle me-3" style="width: 40px; height: 40px; object-fit: cover;">
                                            <div>
                                                <h6 class="fw-bold mb-0">@std.StudentName</h6>
                                                <small class="text-muted">@std.StudentEmail</small>
                                            </div>
                                        </div>
                                    </td>

                                    <td>
                                        <div>
                                            <h6 class="fw-bold mb-0">@Model.CourseName</h6>
                                        </div>
                                    </td>

                                    <td>
                                        <div class="progress mb-1" style="width: 100px; height: 8px;">
                                            @if (std.StudentProgressPercentage >= 0 && std.StudentProgressPercentage <= 30)
                                            {
                                                <div class="progress-bar bg-info" style="width: @(std.StudentProgressPercentage)%"></div>
                                            }
                                            else if (std.StudentProgressPercentage > 30 && std.StudentProgressPercentage <= 65)
                                            {
                                                <div class="progress-bar bg-warning" style="width: @(std.StudentProgressPercentage)%"></div>
                                            }
                                            else
                                            {
                                                <div class="progress-bar bg-success" style="width: @(std.StudentProgressPercentage)%"></div>
                                            }
                                        </div>
                                        <small class="text-muted">@(std.StudentProgressPercentage)% complete</small>
                                    </td>

                                    <td>
                                       
                                        <div class="btn-group btn-group-sm">
                                            @* <a href="/Student/SendMessage/@std.StudentID" class="btn btn-outline-info" title="Send Message">
                                                <i class="fas fa-envelope"></i>
                                            </a> *@

                                            <button type="button"
                                                    class="btn btn-outline-info openMessageModal"
                                                    data-student-id="@std.StudentID"
                                                    data-student-name="@std.StudentName"
                                                    data-student-email="@std.StudentEmail"
                                                    data-student-img="@(std.StudentImageUrl == null
                                                                ? "/Images/Default_User_Image.jpg"
                                                                : "/" + std.StudentImageUrl)">
                                        <i class="fas fa-envelope"></i>
                                    </button>





                                            <a href="/Instructor/Student/DispalyProfile/@std.StudentID?CrsID=@Model.CourseID" class="btn btn-outline-secondary" title="View Profile">
                                                <i class="fas fa-user"></i>
                                            </a>
                                        </div>
                                    </td>


                                </tr>
                            }
                        }

                        
                        

                    </tbody>
                </table>
            </div>

            <nav aria-label="Students pagination" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                        <a class="page-link" href="?id=@Model.CourseID&search=@Model.SearchTerm&page=@(Model.PageIndex - 1)">Previous</a>
                    </li>

                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                            <a class="page-link" href="?id=@Model.CourseID&search=@Model.SearchTerm&page=@i">@i</a>
                        </li>
                    }

                    <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                        <a class="page-link" href="?id=@Model.CourseID&search=@Model.SearchTerm&page=@(Model.PageIndex + 1)">Next</a>
                    </li>
                </ul>
            </nav>

        </div>
    </div>



    <form method="post" id="sendMessageForm" action="/Instructor/Student/SendMessage">
        <input type="hidden" name="StudentID" id="modalStudentID" value="" />
        <input type="hidden" name="StudentEmail" id="modalStudentEmail" value="" />
        <input type="hidden" name="CourseName" id="modalCrsName" value="@Model.CourseName" />
        <input type="hidden" name="CourseID" id="modalCrsID" value="@Model.CourseID" />
        <div class="modal fade" id="MessageModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content modern-light-modal">

                    <div class="modal-header border-0 text-center flex-column">

                        <img id="modalStudentImage"
                             src="/Images/Default_User_Image.jpg"
                             class="student-avatar-light mb-2" />

                        <h4 class="fw-bold text-dark" id="modalStudentName">Send a Message</h4>

                        <button type="button" class="btn-close custom-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">

                        <label class="form-label text-secondary fw-semibold mb-2">Message</label>
                        <textarea name="MessageText"
                                  class="form-control message-box-light"
                                  placeholder="Write your message..."></textarea>

                    </div>

                    <div class="modal-footer border-0 justify-content-end gap-2">

                        <button type="button" class="btn cancel-btn-light" data-bs-dismiss="modal">
                            Cancel
                        </button>

                        <button type="submit" class="btn send-btn-light">
                            Send Message
                        </button>

                    </div>

                </div>
            </div>
        </div>
    </form>







    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="/assets/js/script.js"></script>






    <script>
               document.addEventListener("DOMContentLoaded", function () {

            const modal = new bootstrap.Modal(document.getElementById("MessageModal"));

            document.querySelectorAll(".openMessageModal").forEach(btn => {
                btn.addEventListener("click", () => {

                    const id = btn.dataset.studentId;
                    const name = btn.dataset.studentName;
                    const img = btn.dataset.studentImg;
                    const email = btn.dataset.studentEmail;

                    // Set the hidden input
                    document.getElementById("modalStudentID").value = id;
                     document.getElementById("modalStudentEmail").value = email;

                    document.getElementById("modalStudentName").innerText =
                        "Message to " + name;

                    document.getElementById("modalStudentImage").src = img;

                    modal.show();
                });
            });

        });

    </script>





</body>
</html>
